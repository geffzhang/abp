!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@abp/ng.core"),require("@abp/ng.theme.shared"),require("@angular/core"),require("@ng-bootstrap/ng-bootstrap"),require("@ngx-validate/core"),require("primeng/table"),require("@angular/router"),require("@angular/forms"),require("@ngxs/router-plugin"),require("@ngxs/store"),require("angular-oauth2-oidc"),require("rxjs"),require("rxjs/operators"),require("snq")):"function"==typeof define&&define.amd?define("@abp/ng.account",["exports","@abp/ng.core","@abp/ng.theme.shared","@angular/core","@ng-bootstrap/ng-bootstrap","@ngx-validate/core","primeng/table","@angular/router","@angular/forms","@ngxs/router-plugin","@ngxs/store","angular-oauth2-oidc","rxjs","rxjs/operators","snq"],t):t(((e=e||self).abp=e.abp||{},e.abp.ng=e.abp.ng||{},e.abp.ng.account={}),e.ng_core,e.ng_theme_shared,e.ng.core,e.ngBootstrap,e.core$1,e.table,e.ng.router,e.ng.forms,e.routerPlugin,e.store,e.angularOauth2Oidc,e.rxjs,e.rxjs.operators,e.snq)}(this,(function(e,t,n,r,o,a,i,s,c,l,p,u,d,m,f){"use strict";f=f&&f.hasOwnProperty("default")?f.default:f;var b=function(){return(b=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function g(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function v(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}var h=c.Validators.maxLength,y=(c.Validators.minLength,c.Validators.required),w=function(){function e(e,n,r,o,a){this.fb=e,this.oauthService=n,this.store=r,this.toasterService=o,this.options=a,this.oauthService.configure(this.store.selectSnapshot(t.ConfigState.getOne("environment")).oAuthConfig),this.oauthService.loadDiscoveryDocument(),this.form=this.fb.group({username:["",[y,h(255)]],password:["",[y,h(32)]],remember:[!1]})}return e.prototype.onSubmit=function(){var e=this;this.form.invalid||(this.inProgress=!0,d.from(this.oauthService.fetchTokenUsingPasswordFlow(this.form.get("username").value,this.form.get("password").value)).pipe(m.switchMap((function(){return e.store.dispatch(new t.GetAppConfiguration)})),m.tap((function(){var t=f((function(){return window.history.state})).redirectUrl||(e.options||{}).redirectUrl||"/";e.store.dispatch(new l.Navigate([t]))})),m.catchError((function(t){return e.toasterService.error(f((function(){return t.error.error_description}))||f((function(){return t.error.error.message}),"AbpAccount::DefaultErrorMessage"),"Error",{life:7e3}),d.throwError(t)})),m.finalize((function(){return e.inProgress=!1}))).subscribe())},e.decorators=[{type:r.Component,args:[{selector:"abp-login",template:'<div class="row">\n  <div class="col col-md-4 offset-md-4">\n    <abp-tenant-box></abp-tenant-box>\n\n    <div class="abp-account-container">\n      <h2>{{ \'AbpAccount::Login\' | abpLocalization }}</h2>\n      <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>\n        <div class="form-group">\n          <label for="login-input-user-name-or-email-address">{{\n            \'AbpAccount::UserNameOrEmailAddress\' | abpLocalization\n          }}</label>\n          <input\n            class="form-control"\n            type="text"\n            id="login-input-user-name-or-email-address"\n            formControlName="username"\n            autofocus\n          />\n        </div>\n        <div class="form-group">\n          <label for="login-input-password">{{ \'AbpAccount::Password\' | abpLocalization }}</label>\n          <input class="form-control" type="password" id="login-input-password" formControlName="password" />\n        </div>\n        <div class="form-check" validationTarget validationStyle>\n          <label class="form-check-label" for="login-input-remember-me">\n            <input class="form-check-input" type="checkbox" id="login-input-remember-me" formControlName="remember" />\n            {{ \'AbpAccount::RememberMe\' | abpLocalization }}\n          </label>\n        </div>\n        <div class="mt-2">\n          <abp-button [loading]="inProgress" type="submit">\n            {{ \'AbpAccount::Login\' | abpLocalization }}\n          </abp-button>\n        </div>\n      </form>\n      <div style="padding-top: 20px">\n        <a routerLink="/account/register">{{ \'AbpAccount::Register\' | abpLocalization }}</a>\n      </div>\n    </div>\n  </div>\n</div>\n'}]}],e.ctorParameters=function(){return[{type:c.FormBuilder},{type:u.OAuthService},{type:p.Store},{type:n.ToasterService},{type:void 0,decorators:[{type:r.Optional},{type:r.Inject,args:["ACCOUNT_OPTIONS"]}]}]},e}();var S=function(){function e(){this.selectedTab=0}return e.prototype.ngOnInit=function(){},e.decorators=[{type:r.Component,args:[{selector:"abp-manage-profile",template:'<div class="row entry-row">\n  <div class="col-auto"></div>\n  <div id="breadcrumb" class="col-md-auto pl-md-0"></div>\n  <div class="col"></div>\n</div>\n\n<div id="ManageProfileWrapper">\n  <div class="row">\n    <div class="col-3">\n      <ul class="nav flex-column nav-pills" id="nav-tab" role="tablist">\n        <li class="nav-item pointer" (click)="selectedTab = 0">\n          <a class="nav-link" [ngClass]="{ active: selectedTab === 0 }" role="tab">{{\n            \'AbpUi::ChangePassword\' | abpLocalization\n          }}</a>\n        </li>\n        <li class="nav-item pointer" (click)="selectedTab = 1">\n          <a class="nav-link" [ngClass]="{ active: selectedTab === 1 }" role="tab">{{\n            \'AbpAccount::PersonalSettings\' | abpLocalization\n          }}</a>\n        </li>\n      </ul>\n    </div>\n    <div class="col-9">\n      <div class="tab-content" *ngIf="selectedTab === 0">\n        <div class="tab-pane fade show active" role="tabpanel">\n          <abp-change-password-form></abp-change-password-form>\n        </div>\n      </div>\n      <div class="tab-content" *ngIf="selectedTab === 1">\n        <div class="tab-pane fade show active" role="tabpanel">\n          <abp-personal-settings-form></abp-personal-settings-form>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'}]}],e.ctorParameters=function(){return[]},e}();var A=function(){function e(e){this.rest=e}return e.prototype.findTenant=function(e){var t={method:"GET",url:"/api/abp/multi-tenancy/tenants/by-name/"+e};return this.rest.request(t)},e.prototype.register=function(e){var t={method:"POST",url:"/api/account/register",body:e};return this.rest.request(t,{skipHandleError:!0})},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:t.RestService}]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e(r.ɵɵinject(t.RestService))},token:e,providedIn:"root"}),e}();var N=c.Validators.maxLength,C=(c.Validators.minLength,c.Validators.required),P=c.Validators.email,T=function(){function e(e,n,r,o,a){this.fb=e,this.accountService=n,this.oauthService=r,this.store=o,this.toasterService=a,this.oauthService.configure(this.store.selectSnapshot(t.ConfigState.getOne("environment")).oAuthConfig),this.oauthService.loadDiscoveryDocument(),this.form=this.fb.group({username:["",[C,N(255)]],password:["",[C,N(32)]],email:["",[C,P]]})}return e.prototype.onSubmit=function(){var e=this;if(!this.form.invalid){this.inProgress=!0;var n={userName:this.form.get("username").value,password:this.form.get("password").value,emailAddress:this.form.get("email").value,appName:"Angular"};this.accountService.register(n).pipe(m.switchMap((function(){return d.from(e.oauthService.fetchTokenUsingPasswordFlow(n.userName,n.password))})),m.switchMap((function(){return e.store.dispatch(new t.GetAppConfiguration)})),m.tap((function(){return e.store.dispatch(new l.Navigate(["/"]))})),m.take(1),m.catchError((function(t){return e.toasterService.error(f((function(){return t.error.error_description}))||f((function(){return t.error.error.message}),"AbpAccount::DefaultErrorMessage"),"Error",{life:7e3}),d.throwError(t)})),m.finalize((function(){return e.inProgress=!1}))).subscribe()}},e.decorators=[{type:r.Component,args:[{selector:"abp-register",template:'<div class="row">\n  <div class="col col-md-4 offset-md-4">\n    <abp-tenant-box></abp-tenant-box>\n\n    <div class="abp-account-container">\n      <h2>{{ \'AbpAccount::Register\' | abpLocalization }}</h2>\n      <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>\n        <div class="form-group">\n          <label for="input-user-name">{{ \'AbpAccount::UserName\' | abpLocalization }}</label\n          ><span> * </span\n          ><input autofocus type="text" id="input-user-name" class="form-control" formControlName="username" />\n        </div>\n        <div class="form-group">\n          <label for="input-email-address">{{ \'AbpAccount::EmailAddress\' | abpLocalization }}</label\n          ><span> * </span><input type="email" id="input-email-address" class="form-control" formControlName="email" />\n        </div>\n        <div class="form-group">\n          <label for="input-password">{{ \'AbpAccount::Password\' | abpLocalization }}</label\n          ><span> * </span><input type="password" id="input-password" class="form-control" formControlName="password" />\n        </div>\n        <abp-button [loading]="inProgress" type="submit">\n          {{ \'AbpAccount::Register\' | abpLocalization }}\n        </abp-button>\n      </form>\n      <div style="padding-top: 20px">\n        <a routerLink="/account/login">{{ \'AbpAccount::Login\' | abpLocalization }}</a>\n      </div>\n    </div>\n  </div>\n</div>\n'}]}],e.ctorParameters=function(){return[{type:c.FormBuilder},{type:A},{type:u.OAuthService},{type:p.Store},{type:n.ToasterService}]},e}();var L=[{path:"",pathMatch:"full",redirectTo:"login"},{path:"",component:t.DynamicLayoutComponent,children:[{path:"login",component:w},{path:"register",component:T},{path:"manage-profile",component:S}]}],x=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{imports:[s.RouterModule.forChild(L)],exports:[s.RouterModule]}]}],e}(),M=(c.Validators.minLength,c.Validators.required),O=["newPassword","repeatNewPassword"],z=function(){function e(e,t,n){this.fb=e,this.store=t,this.toasterService=n,this.mapErrorsFn=function(e,t,n){return O.indexOf(n.name)<0?e:e.concat(t.filter((function(e){return"passwordMismatch"===e.key})))}}return e.prototype.ngOnInit=function(){this.form=this.fb.group({password:["",M],newPassword:["",M],repeatNewPassword:["",M]},{validators:[a.comparePasswords(O)]})},e.prototype.onSubmit=function(){var e=this;this.form.invalid||this.store.dispatch(new t.ChangePassword({currentPassword:this.form.get("password").value,newPassword:this.form.get("newPassword").value})).subscribe({next:function(){e.form.reset(),e.toasterService.success("AbpAccount::PasswordChangedMessage","Success",{life:5e3})},error:function(t){e.toasterService.error(f((function(){return t.error.error.message}),"AbpAccount::DefaultErrorMessage"),"Error",{life:7e3})}})},e.decorators=[{type:r.Component,args:[{selector:"abp-change-password-form",template:'<form [formGroup]="form" (ngSubmit)="onSubmit()" [mapErrorsFn]="mapErrorsFn">\n  <div class="form-group">\n    <label for="current-password">{{ \'AbpIdentity::DisplayName:CurrentPassword\' | abpLocalization }}</label\n    ><span> * </span\n    ><input type="password" id="current-password" class="form-control" formControlName="password" autofocus />\n  </div>\n  <div class="form-group">\n    <label for="new-password">{{ \'AbpIdentity::DisplayName:NewPassword\' | abpLocalization }}</label\n    ><span> * </span><input type="password" id="new-password" class="form-control" formControlName="newPassword" />\n  </div>\n  <div class="form-group">\n    <label for="confirm-new-password">{{ \'AbpIdentity::DisplayName:NewPasswordConfirm\' | abpLocalization }}</label\n    ><span> * </span\n    ><input type="password" id="confirm-new-password" class="form-control" formControlName="repeatNewPassword" />\n  </div>\n  <abp-button iconClass="fa fa-check" buttonClass="btn btn-primary color-white" (click)="onSubmit()">{{\n    \'AbpIdentity::Save\' | abpLocalization\n  }}</abp-button>\n</form>\n'}]}],e.ctorParameters=function(){return[{type:c.FormBuilder},{type:p.Store},{type:n.ToasterService}]},e}();var I=c.Validators.maxLength,k=c.Validators.required,U=c.Validators.email,E=function(){function e(e,t,n){this.fb=e,this.store=t,this.toasterService=n}return e.prototype.buildForm=function(){var e=this;this.store.dispatch(new t.GetProfile).pipe(m.withLatestFrom(this.profile$),m.take(1)).subscribe((function(t){var n=v(t,2)[1];e.form=e.fb.group({userName:[n.userName,[k,I(256)]],email:[n.email,[k,U,I(256)]],name:[n.name||"",[I(64)]],surname:[n.surname||"",[I(64)]],phoneNumber:[n.phoneNumber||"",[I(16)]]})}))},e.prototype.submit=function(){var e=this;this.form.invalid||this.store.dispatch(new t.UpdateProfile(this.form.value)).subscribe((function(){e.toasterService.success("AbpAccount::PersonalSettingsSaved","Success",{life:5e3})}))},e.prototype.ngOnInit=function(){this.buildForm()},e.decorators=[{type:r.Component,args:[{selector:"abp-personal-settings-form",template:'<form novalidate *ngIf="form" [formGroup]="form" (ngSubmit)="submit()">\n  <div class="form-group">\n    <label for="username">{{ \'AbpIdentity::DisplayName:UserName\' | abpLocalization }}</label\n    ><span> * </span><input type="text" id="username" class="form-control" formControlName="userName" autofocus />\n  </div>\n  <div class="row">\n    <div class="col col-md-6">\n      <div class="form-group">\n        <label for="name">{{ \'AbpIdentity::DisplayName:Name\' | abpLocalization }}</label\n        ><input type="text" id="name" class="form-control" formControlName="name" />\n      </div>\n    </div>\n    <div class="col col-md-6">\n      <div class="form-group">\n        <label for="surname">{{ \'AbpIdentity::DisplayName:Surname\' | abpLocalization }}</label\n        ><input type="text" id="surname" class="form-control" formControlName="surname" />\n      </div>\n    </div>\n  </div>\n  <div class="form-group">\n    <label for="email-address">{{ \'AbpIdentity::DisplayName:Email\' | abpLocalization }}</label\n    ><span> * </span><input type="text" id="email-address" class="form-control" formControlName="email" />\n  </div>\n  <div class="form-group">\n    <label for="phone-number">{{ \'AbpIdentity::DisplayName:PhoneNumber\' | abpLocalization }}</label\n    ><input type="text" id="phone-number" class="form-control" formControlName="phoneNumber" />\n  </div>\n  <abp-button iconClass="fa fa-check" buttonClass="btn btn-primary color-white" (click)="submit()">\n    {{ \'AbpIdentity::Save\' | abpLocalization }}</abp-button\n  >\n</form>\n'}]}],e.ctorParameters=function(){return[{type:c.FormBuilder},{type:p.Store},{type:n.ToasterService}]},function(e,t,n,r){var o,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,n,i):o(t,n))||i);a>3&&i&&Object.defineProperty(t,n,i)}([p.Select(t.ProfileState.getProfile),g("design:type",d.Observable)],e.prototype,"profile$",void 0),e}();var q=function(){function e(e,t,n){this.store=e,this.toasterService=t,this.accountService=n,this.tenant={}}return e.prototype.ngOnInit=function(){this.tenant=this.store.selectSnapshot(t.SessionState.getTenant)||{},this.tenantName=this.tenant.name||""},e.prototype.onSwitch=function(){this.isModalVisible=!0},e.prototype.save=function(){var e=this;this.tenant.name?this.accountService.findTenant(this.tenant.name).pipe(m.take(1),m.catchError((function(t){return e.toasterService.error(f((function(){return t.error.error_description}),"AbpUi::DefaultErrorMessage"),"AbpUi::Error"),d.throwError(t)}))).subscribe((function(n){var r=n.success,o=n.tenantId;r?(e.tenant={id:o,name:e.tenant.name},e.tenantName=e.tenant.name,e.isModalVisible=!1):(e.toasterService.error("AbpUiMultiTenancy::GivenTenantIsNotAvailable","AbpUi::Error",{messageLocalizationParams:[e.tenant.name]}),e.tenant={}),e.store.dispatch(new t.SetTenant(r?e.tenant:null))})):(this.store.dispatch(new t.SetTenant(null)),this.tenantName=null,this.isModalVisible=!1)},e.decorators=[{type:r.Component,args:[{selector:"abp-tenant-box",template:'<div\n  class="tenant-switch-box"\n  style="background-color: #eee; margin-bottom: 20px; color: #000; padding: 10px; text-align: center;"\n>\n  <span style="color: #666;">{{ \'AbpUiMultiTenancy::Tenant\' | abpLocalization }}: </span>\n  <strong>\n    <i>{{ tenantName || (\'AbpUiMultiTenancy::NotSelected\' | abpLocalization) }}</i>\n  </strong>\n  (<a id="abp-tenant-switch-link" style="color: #333; cursor: pointer" (click)="onSwitch()">{{\n    \'AbpUiMultiTenancy::Switch\' | abpLocalization\n  }}</a\n  >)\n</div>\n\n<abp-modal [(visible)]="isModalVisible" size="md">\n  <ng-template #abpHeader>\n    <h5>Switch Tenant</h5>\n  </ng-template>\n  <ng-template #abpBody>\n    <form (ngSubmit)="save()">\n      <div class="mt-2">\n        <div class="form-group">\n          <label for="name">{{ \'AbpUiMultiTenancy::Name\' | abpLocalization }}</label>\n          <input [(ngModel)]="tenant.name" type="text" id="name" name="tenant" class="form-control" autofocus />\n        </div>\n        <p>{{ \'AbpUiMultiTenancy::SwitchTenantHint\' | abpLocalization }}</p>\n      </div>\n    </form>\n  </ng-template>\n  <ng-template #abpFooter>\n    <button #abpClose type="button" class="btn btn-secondary">\n      {{ \'AbpTenantManagement::Cancel\' | abpLocalization }}\n    </button>\n    <button type="button" class="btn btn-primary" (click)="save()">\n      <i class="fa fa-check mr-1"></i> <span>{{ \'AbpTenantManagement::Save\' | abpLocalization }}</span>\n    </button>\n  </ng-template>\n</abp-modal>\n'}]}],e.ctorParameters=function(){return[{type:p.Store},{type:n.ToasterService},{type:A}]},e}();function j(e){return b({redirectUrl:"/"},e)}var D=new r.InjectionToken("ACCOUNT_OPTIONS"),V=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{declarations:[w,T,q,z,S,E],imports:[t.CoreModule,x,n.ThemeSharedModule,i.TableModule,o.NgbDropdownModule,a.NgxValidateCoreModule],exports:[]}]}],e}();e.ACCOUNT_OPTIONS=D,e.ACCOUNT_ROUTES={routes:[{name:"Account",path:"account",invisible:!0,layout:"application",children:[{path:"login",name:"Login",order:1},{path:"register",name:"Register",order:2}]}]},e.AccountModule=V,e.AccountProviders=function(e){return void 0===e&&(e={}),[{provide:D,useValue:e},{provide:"ACCOUNT_OPTIONS",useFactory:j,deps:[D]}]},e.ChangePasswordComponent=z,e.LoginComponent=w,e.ManageProfileComponent=S,e.PersonalSettingsComponent=E,e.RegisterComponent=T,e.optionsFactory=j,e.ɵa=w,e.ɵc=T,e.ɵd=A,e.ɵe=q,e.ɵf=z,e.ɵg=S,e.ɵh=E,e.ɵi=x,e.ɵj=j,e.ɵk=D,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=abp-ng.account.umd.min.js.map